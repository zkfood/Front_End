<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="icon" href="../../assets/logo-icon.png" type="image/png">

    <link rel="stylesheet" href="../../css/dashboardLogin.css">
    <title>Login Dashboard</title>
</head>

<body>
    <div class="navbar">
        <div class="container-navbar">
            <img src="../../assets/logo-ZKFOOD.png" alt="logo do ZKfood">
        </div>
    </div>
    <!-- Formulário Login -->
    <div id="login" class="banner-login">
        <div class="container-login">
            <div class="formulario-login">
                <div class="container-form">
                    <div class="email-grupo">
                        <label for="email">Email</label>
                        <input class="input" type="email" id="email" placeholder="Digite seu e-mail">
                    </div>

                    <div class="senha-grupo">
                        <label for="password">Senha</label>
                        <input type="password" id="password" placeholder="Digite sua senha">
                    </div>
                </div>
                <button onclick="login()" class="botao-login">ENTRAR</button>
            </div>
            <div class="texto-comecar">
                <span>Ge</span>
                <span>ren</span>
                <span>ciar</span>
            </div>
        </div>
    </div>

    <!-- Popup de Sucesso/Erro -->
    <div id="popup" class="popup">
        <div class="popup-background">
            <div class="popup-content">
                <span class="close" onclick="closePopup()">&times;</span>
                <img id="popup-icon" src="" alt="Icon">
                <h2 id="popup-title" class="popup-title"></h2>
                <p id="popup-message" class="popup-message"></p>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelector('.botao-login').addEventListener('click', login);
    });

    async function login() {
        const url = 'http://localhost:8080/relatorios/entrar';

        try {
            let headers = new Headers();
            headers.append('Content-Type', 'application/json');
            headers.append('Accept', '*/*');
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const resposta = await fetch(url, {
                method: "POST",
                headers: headers,
                body: JSON.stringify({
                    email: email,
                    senha: password
                })
            });

            if (resposta.ok) {
                const respostaJson = await resposta.json();

                // Guardar todos os dados do usuário no sessionStorage
                sessionStorage.setItem('usuario', JSON.stringify(respostaJson));
                sessionStorage.setItem('idUsuario', JSON.stringify(respostaJson.id))

                showPopup('LOGIN FEITO COM SUCESSO!', 'Que tal uma feijoada?!', 'success', () => {
                    window.location.href = "../../html/dashboard/dashboard_produto.html";
                });
            } else if (resposta.status === 400) {
                showPopup('ERRO NO LOGIN!', '(Campos de email e senha são obrigatórios)', 'error');
            } else if (resposta.status === 401 || resposta.status === 500 || resposta.status === 204) {
                showPopup('ERRO NO LOGIN!', '(Email ou senha incorretos)', 'error');
            }
        } catch (erro) {
            console.log("Erro: ", erro);
            showPopup('ERRO NO LOGIN!', '(Email ou senha incorretos)', 'error');
        }
    }

    function showPopup(title, message, type, callback) {
        const popup = document.getElementById('popup');
        const popupTitle = document.getElementById('popup-title');
        const popupMessage = document.getElementById('popup-message');
        const popupIcon = document.getElementById('popup-icon');
        popupTitle.textContent = title;
        popupMessage.textContent = message;

        if (type === 'success') {
            popupTitle.style.color = '#33D700';
            popupIcon.src = '../../assets/sucesso.png';
        } else if (type === 'error') {
            popupTitle.style.color = '#EB3223';
            popupIcon.src = '../../assets/erro.png';
        }

        popup.style.display = 'flex';


        setTimeout(() => {
            closePopup();
            if (callback) {
                callback();
            }
        }, 1250);
    }

    function closePopup() {
        document.getElementById('popup').style.display = 'none';
    }
</script>