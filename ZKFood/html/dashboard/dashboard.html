<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="../../css/dashboard.css">

    <link rel="icon" href="/ZKFood/assets/logo-icon.png" type="image/png">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <title>Dashboard - Gráfico de Produtos</title>
</head>

<body>
    <div class="container_sep_info_dash">
        <div class="container_info">
            <div class="container_logo">
                <img src="../../assets/logo-icon.png" alt="zkFood_logo">
            </div>
            <div class="container_texto_Bem_vindo">
                Bem Vindo, <br>
                <h2>Zeca Silva</h2>
            </div>
            <div class="container_txt_dashboard">
                Dashboards
            </div>
            <div class="container_opcoes_dash">
                <ul>
                    <li id="opcao_selecionada"><img src="../../assets/jantar 1.png" alt=""> Produtos</li>
                    <div class="container_sub_opcoes_dash">
                        <ul>
                            <li> > <span id="sub_opcao_selecionada"> <a href="./dashboard.html"> Dashboard </a></span>
                            </li>
                            <li> > <a href="./crud_produtos.html"> Análise de Produtos </a> </li>
                            <li> > <a href="./cadastro_produtos.html"> Cadastrar Produtos </a></li>
                        </ul>
                    </div>
                    <li> > <img src="../../assets/silhueta-de-multiplos-usuarios 1.png" alt=""> Clientes</li>
                    <li> > <img src="../../assets/cracha 1.png" alt=""> Funcionários</li>
                    <li> > <img src="../../assets/avaliacoes 1.png" alt=""><a href="./avaliacoes.html">Avaliações</a></li>
                    <li> > <img src="../../assets/money-bag 1.png" alt=""> Financeiro</li>
                </ul>
            </div>
        </div>
        <div class="container_dash">
            <div class="container_cards_kpi">
                <div class="kpi_card">
                    <div class="container_dados_kpi">
                        <div id="barra_cor_status_bom"></div>
                        <div class="container_kpi_img">
                            <div class="kpi_dados">
                                <span id="produto_mais_vendido">Produto Mais Vendido</span><br><br>
                                <span id="quantidade_produto_mais_vendido"></span>
                            </div>
                            <div class="container_img_kpi">
                                <div class="fundo_img_kpi">
                                    <img src="../../assets/Money Bag.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container_comparacao_kpi">
                        <div class="img_status_mes">
                            <img src="../../assets/crescimento.png" alt="">
                        </div>
                        <span id="status_diferenca_mes_bom">1°</span><span id="valor_diferenca_bom">Mais vendido no
                            mês</span>
                    </div>
                </div>

                <div class="kpi_card">
                    <div class="container_dados_kpi">
                        <div id="barra_cor_status_bom"></div>
                        <div class="container_kpi_img">
                            <div class="kpi_dados">
                                <span id="produto_segundo_mais_vendido">Segundo Produto Mais Vendido</span><br><br>
                                <span id="quantidade_produto_segundo_mais_vendido"></span>
                            </div>
                            <div class="container_img_kpi">
                                <div class="fundo_img_kpi">
                                    <img src="../../assets/Money Bag.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container_comparacao_kpi">
                        <div class="img_status_mes">
                            <img src="../../assets/crescimento.png" alt="">
                        </div>
                        <span id="status_diferenca_mes_bom">2°</span><span id="valor_diferenca_bom">Segundo mais vendido
                            no mês</span>
                    </div>
                </div>

                <div class="kpi_card">
                    <div class="container_dados_kpi">
                        <div id="barra_cor_status_erro"></div>
                        <div class="container_kpi_img">
                            <div class="kpi_dados">
                                <span id="produto_menos_vendido">Produto Menos Vendido</span><br><br>
                                <span id="quantidade_produto_menos_vendido"></span>
                            </div>
                            <div class="container_img_kpi">
                                <div class="fundo_img_kpi">
                                    <img src="../../assets/Money Bag.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container_comparacao_kpi">
                        <div class="img_status_mes">
                            <img src="../../assets/decadencia.png" alt="">
                        </div>
                        <span id="status_diferenca_mes_ruim">1°</span><span id="valor_diferenca_ruim">Menos vendido no
                            mês</span>
                    </div>
                </div>

                <div class="kpi_card">
                    <div class="container_dados_kpi">
                        <div id="barra_cor_status_erro"></div>
                        <div class="container_kpi_img">
                            <div class="kpi_dados">
                                <span id="produto_segundo_menos_vendido">Segundo Produto Menos Vendido</span><br><br>
                                <span id="quantidade_produto_segundo_menos_vendido"></span>
                            </div>
                            <div class="container_img_kpi">
                                <div class="fundo_img_kpi">
                                    <img src="../../assets/Money Bag.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container_comparacao_kpi">
                        <div class="img_status_mes">
                            <img src="../../assets/decadencia.png" alt="">
                        </div>
                        <span id="status_diferenca_mes_ruim">2°</span><span id="valor_diferenca_ruim">Segundo menos
                            vendido no mês</span>
                    </div>
                </div>


            </div>
            <div class="container_dashboard_produtos_mais_vendidos">
                <div class="titulo_dashboard">
                    PRODUTOS MAIS VENDIDOS
                </div>
                <div class="container_dash_dados">
                    <div id="dash_produtos">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="container_dashboard_produtos_mais_vendidos">
        <div class="titulo_dashboard">
            RECEITA ANUAL POR TIPO DE ENTREGA
        </div>
        <div class="container_dash_dados">
            <canvas id="receitaAnualChart"></canvas>
        </div>
    </div>
</body>

</html>
<script src="../../js/fetch.js"></script>
<script>
    // Defina o ambiente (local/prod)
    
    // Função para buscar dados da API e atualizar o gráfico
    async function buscarDadosEAtualizar() {
        const url = `${ambiente.local}relatorios/financeiro/receita-por-anos`;
        const fetchBuilder = new FetchBuilder();

        try {
            // Busca dados da API utilizando FetchBuilder
            const dadosReceita = await fetchBuilder.request(url);

            // Extrai dados do JSON para preencher o gráfico
            const anos = dadosReceita.anos;
            const receitaPresencial = dadosReceita.receitaPresencial;
            const receitaBalcao = dadosReceita.receitaBalcao;
            const receitaEntrega = dadosReceita.receitaEntrega;

            // Cria o gráfico com os dados obtidos
            const ctx = document.getElementById('receitaAnualChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: anos,
                    datasets: [
                        {
                            label: 'Presencial',
                            data: receitaPresencial,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: false,
                            tension: 0.1
                        },
                        {
                            label: 'Balcão',
                            data: receitaBalcao,
                            borderColor: 'rgb(255, 159, 64)',
                            backgroundColor: 'rgba(255, 159, 64, 0.2)',
                            fill: false,
                            tension: 0.1
                        },
                        {
                            label: 'Entrega',
                            data: receitaEntrega,
                            borderColor: 'rgb(153, 102, 255)',
                            backgroundColor: 'rgba(153, 102, 255, 0.2)',
                            fill: false,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Receita Anual por Tipo de Entrega'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Ano'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Receita (em R$)'
                            }
                        }
                    }
                }
            });

        } catch (error) {
            console.error("Erro ao carregar dados do gráfico:", error);
        }
    }
    async function buscarKPIsProdutos() {
    const url = `${ambiente.local}relatorios/kpis-produtos`;
    const fetchBuilder = new FetchBuilder();

    try {
        // Busca dados da API utilizando FetchBuilder
        const dadosKPIs = await fetchBuilder.request(url);

        // Atualiza os dados dos produtos mais vendidos no DOM
        document.getElementById("produto_mais_vendido").textContent = dadosKPIs.top3Melhores[0][0]; 
        document.getElementById("quantidade_produto_mais_vendido").textContent = dadosKPIs.top3Melhores[0][1];

        document.getElementById("produto_segundo_mais_vendido").textContent = dadosKPIs.top3Melhores[1][0]; 
        document.getElementById("quantidade_produto_segundo_mais_vendido").textContent = dadosKPIs.top3Melhores[1][1]; 

        document.getElementById("produto_menos_vendido").textContent = dadosKPIs.top3Piores[0][0]; 
        document.getElementById("quantidade_produto_menos_vendido").textContent = dadosKPIs.top3Piores[0][1]; 

        document.getElementById("produto_segundo_menos_vendido").textContent = dadosKPIs.top3Piores[1][0]; 
        document.getElementById("quantidade_produto_segundo_menos_vendido").textContent = dadosKPIs.top3Piores[1][1];

    } catch (error) {
        console.error("Erro ao carregar dados dos produtos:", error);
    }
}




    window.onload = async () => {
    await buscarDadosEAtualizar();
    await buscarKPIsProdutos();
};
</script>